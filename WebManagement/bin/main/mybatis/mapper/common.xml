<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="com.mrc.db.mapper.ICommonMapper">
	<select id="getList"
		parameterType="com.mrc.db.dto.common.common_cond"
		resultType="com.mrc.db.dto.common.t_common">
		select *
		from t_common
		<where>
			
			<if test="main_code != null and main_code != '' ">
				and main_code = #{main_code}
			</if>
			<if test="sub_code != null ">
				and sub_code LIKE #{sub_code}
			</if>
			<if test="name != null and name != '' ">
				and name LIKE CONCAT('%', #{name}, '%')
			</if>
			<if test="addCond != null and addCond != '' ">
				${addCond}
			</if>
			<if test="hide != null  ">
				and hide = #{hide}
			</if>
		</where>
	</select>
	<select id="getSelectItemList"
		parameterType="com.mrc.db.dto.common.common_cond"
		resultType="com.mrc.db.dto.common.SelectItem">
		select *
		from t_common
		<where>
			<if test="main_code != null and main_code != '' ">
				and main_code = #{main_code}
			</if>
			<if test="sub_code != null ">
				and sub_code LIKE #{sub_code}
			</if>
			<if test="name != null and name != '' ">
				and name LIKE CONCAT('%', #{name}, '%')
			</if>
			<if test="addCond != null and addCond != '' ">
				${addCond}
			</if>
			<if test="hide != null  ">
				and hide = #{hide}
			</if>
		</where>
	</select>

	<insert id="Save" parameterType="com.mrc.db.dto.common.t_common">
		
		set @sub_code = 0;
		
		<choose>
			<when test="sub_code == null  ">
				set @sub_code = (select ifnull(max(SUB_CODE),0) + 1 from t_common
				where main_code =  #{main_code});
			</when>
			<otherwise>
				set @sub_code = #{sub_code};
			</otherwise>
		</choose>
	
			
		INSERT INTO t_common
		(main_code, sub_code, name, order_seq, ref_data1, ref_data2, ref_data3,
		ref_data4, hide, insert_code, insert_date, update_code, update_date)
		values( #{main_code}, @sub_code, #{name}, #{order_seq}, #{ref_data1},
		#{ref_data2}, #{ref_data3}, #{ref_data4}, #{hide}, #{update_code},
		#{update_date}, #{update_code}, localtime())
		ON DUPLICATE KEY UPDATE
		  name      = #{name}
		, order_seq = #{order_seq} 
		, ref_data1 = #{ref_data1}
		, ref_data2 = #{ref_data2}
		, ref_data3 = #{ref_data3}
		, ref_data4 = #{ref_data4}
		, hide = #{hide}
		, update_code = #{update_code}
		, update_date = localtime();
	</insert>



	<delete id="remove"
		parameterType="com.mrc.db.dto.common.t_common">
		delete from t_common
		<where>
			<if test="main_code != null and main_code != '' ">
				and main_code = #{main_code}
			</if>
			<if test="sub_code != null ">
				and sub_code like #{code}
			</if>
		</where>
	</delete>



	<update id="update"
		parameterType="com.mrc.db.dto.common.t_common">

		update T_common
		set name = #{name}
		  , order_seq   = #{order_seq}
		  , ref_data1   = #{ref_data1}
		  , ref_data2   = #{ref_data2}
		  , ref_data3   = #{ref_data3}
		  , ref_data4   = #{ref_data4}
		  , hide        = #{hide}
		  , update_code = #{update_code}
		  , update_date = localtime();
        where main_code = #{main_code}
		  and sub_code  = #{sub_code}

	</update>


</mapper>